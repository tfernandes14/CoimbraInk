{% extends 'base.html' %}
{% load static %}

{% block simulador %}
	{% csrf_token %}

	 <div class="row" style="height: 100px;"></div>
	 <div class="row">
		<div class="col-md-3" style="margin-left:5%">
			<input class="form-control" id="inputSearch" type="text" placeholder="Search location.." style="background: #F4F1F0;">
			<div class="table-wrapper-scroll-y my-custom-scrollbar mt-2" style="background: #F4F1F0;border-radius:10px;height: 415px;">
                <ul class="list-group" id="myRep">
                    {% for repo in reprografias %}
                    	{% for aquatro in A4 %}
                    		{% ifequal aquatro.reprografia_id repo.id %}
                    			{% ifnotequal aquatro.frente_preto_branco_preco -1 %}
			                        <div class=" list-group-item mb-2 " id="reprografia" data-param1="{{repo.nome}}" data-param2="{{repo.contacto}}" data-param3="{{repo.id}}" style="border-radius:10px;">
			                            <span class="rep-name">{{repo.nome}} </span>
			                        </div>
			                    {% endifnotequal %}
			                {% endifequal %}
			            {% endfor %}     
                    {% endfor %}
                </ul>
			</div>
		</div>
		<div class="col-md-5">
			<form method='post'>
			<div class="table-wrapper-scroll-y  mt-2" style="background: #F4F1F0;border-radius:10px;">
				<h2  class="nomeselecionado" style="margin-left: 20px;font-weight: bold;font-size: 30px;color: #286895;text-align:center">Nome Selecionado</h2>
				<div class="row">
					<div class="col-4">
						<p style="color: #286895;font-size: 20px;font-weight: bold;margin-left: 10px;">Tipo pagina: </p>
					</div>
					<div class="col">
						<select id = "paginas" style="border-radius: 5px; box-shadow: 5px 5px 5px grey;">
							<option id="A0" value="Azero">A0</option>
							<option id="A1" value="Aum">A1</option>
							<option id="A2" value="Adois">A2</option>
							<option id="A3" value="Atres">A3</option>
							<option id="A4" value="Aquatro">A4</option>
							<option id="A5" value="Acinco">A5</option>
						</select>
					</div>
				</div>
				<div class="row">
					<div class="col-4">
						<p style="color: #286895;font-size: 20px;font-weight: bold;margin-left: 10px;">Nº paginas </p>
					</div>
					<div class="col">
						<input type="text" name="lname" style="height:30px;box-shadow: 5px 5px 5px grey;border: 1px solid #DCDCDC;border-radius: 5px;">
					</div>
				</div>
				<div class="row" id="preto_branco">
	          		<div class="col-4">
							<p style="color: #286895;font-size: 20px;font-weight: bold;margin-left: 10px;">Preto e Branco </p>
					</div>
					<div class="col">
						<label class="checkbox">
	              			<input type="checkbox" value="preto_branco"/>
								<span style="font-size: 20px;"></span>
	          			</label>
					</div>
				</div>
				<div class="row" id="cores">
					<div class="col-4">
						<p style="color: #286895;font-size: 20px;font-weight: bold;margin-left: 10px;">Cores </p>
					</div>
					<div class="col">
						<label class="checkbox">
	              			<input type="checkbox" value="cores"/>
								<span style="font-size: 20px;"></span>
	          			</label>
					</div>
				</div>
				<div class="row" id="encadernacao">
					<div class="col-4">
						<p style="color: #286895;font-size: 20px;font-weight: bold;margin-left: 10px;">Encadernacao </p>
					</div>
					<div class="col">
						<label class="checkbox">
	              			<input type="checkbox" value="encadernar"/>
								<span style="font-size: 20px;"></span>
	         			 </label>
					</div>

				</div>
				<div class="row" id="plastificacao">
          			<div class="col-4">
						<p style="color: #286895;font-size: 20px;font-weight: bold;margin-left: 10px;">Plastificacao </p>
					</div>
					<div class="col">
						<label class="checkbox">
	              			<input type="checkbox" value="plastificar"/>
								<span style="font-size: 20px;"></span>
	          			</label>
					</div>
				</div>
				<div class="row">
					<div class="col-2">
						<p style="color: #286895;font-size: 20px;font-weight: bold;margin-left: 10px;">Total: </p>
					</div>
					<div class="col" >
						<p style="color:rgb(64, 64, 64);font-size: 20px;">14,00 € </p>
					</div>
				</div>
				<div class="row">
					<div class="col">
						<button class=" list-group-item" style="font-size: 17px; border-radius:10px;font-weight: bold;color: #286895;" id="simular" type="submit">Simular</button>
					</div>
					<div class="col" align="right">
						<button class=" list-group-item" style="font-size: 17px; border-radius:10px;font-weight: bold;color: #286895;" id="adicionar" type="submit">Adicionar</button>
					</div>
				</div>
			</div>
			</form>
		</div>
		<div class="col-md-3">
			<div class="table-wrapper-scroll-y my-custom-scrollbar mt-2" style="background: #F4F1F0;border-radius:10px;">
				<h2  style="margin-left: 20px;font-weight: bold;font-size: 30px;color: #286895;">Documento</h2>

					{% for f in ficheiros %}
						{% if f != 'v' %}
							<label class="checkbox1">
				                <input id={{ f }} type="checkbox"/>
				                <span style="color:rgb(64, 64, 64);font-size: 23px;font-weight: bold;">{{f}}</span>
				            </label>
				           {% endif %}
					{% endfor %}
				<form method='post' enctype="multipart/form-data">
					{% csrf_token %}
					<input name="document" type="file"/>
					<button class=" list-group-item" style="margin-left: 30%;font-size: 17px; margin-top: 50%;border-radius:10px;font-weight: bold;color: #286895;" id="novoDoc" type="submit">Novo Documento</button>
				</form>
			</div>
		</div>
	</div>

    <script>
    	var pk;
	    $(document).ready(function(){
            $("#inputSearch").on("keyup", function() {
      		   var filter, i=0;
               filter = $(this).val().toLowerCase();
               console.log(filter);

               $.each($('#myRep #reprografia'), function() {
                  var element = this;
                  var nome = element.getElementsByTagName("span")[0];
                  nome = nome.textContent || nome.innerText;
                  if (nome.toLowerCase().indexOf(filter) > -1) {
                      element.style.display = "";
                  }
                  else{
                      element.style.display = "none";
                  }
               });
            });
        });

	    $('#myRep #reprografia').click(function() {
	        var $div = $(this);
	        var param1 = $div.attr('data-param1');
	        var param2 = $div.attr('data-param2');
	        pk = $div.attr('data-param3');
	        var dados;
	        
	        console.log(pk);

	        $('.nomeselecionado').text(param1);
	        console.log(param1);
	        console.log(param2);
	        
	        const csrf_token = document.getElementsByName("csrfmiddlewaretoken")[0].value
		    $.ajaxSetup({
		        headers:{
		            "X-CSRFToken": csrf_token
		        }
		    });

		    for(let i = 0; i < 6; i++){
	    		var elemento = document.getElementById("A" + (i).toString());
	    		elemento.style.display = "";
		    }

		    document.getElementById("cores").style.display="";
		    document.getElementById("preto_branco").style.display="";
		    document.getElementById("encadernacao").style.display="";
		    document.getElementById("plastificacao").style.display="";
		    

	        $.ajax({
        
		        url: window.location.origin + "/simulador/"+ pk + "/",
		        type: "PATCH",
		        contentType:"application/json",
		        success: (response_data)=>{
		            
		            dados = response_data;

		            for(let i = 0; i < dados.length; i++){
				    	console.log(dados[i]["frente_preto_branco_preco"]);
				    	if(dados[i]["frente_preto_branco_preco"] == -1){

				    		var elemento = document.getElementById("A" + (5-i).toString());
				    		elemento.style.display = "none";
				    	}
				    }

		        },
		        failure:(response_data)=>{
		            console.log("FAILURE===", response_data);
		        }

		    });
		    


	     });


		$("select#paginas").change(function(){	    
		   var choice = $( "#paginas option:selected" ).val();

		   const csrf_token = document.getElementsByName("csrfmiddlewaretoken")[0].value
		    $.ajaxSetup({
		        headers:{
		            "X-CSRFToken": csrf_token
		        }
		    });

		    

		    $.ajax({
        
		        url: window.location.origin + "/busca_pagina/"+ pk + "/" + choice + "/",
		        type: "PATCH",
		        contentType:"application/json",
		        success: (response_data)=>{
		            
		            dados = response_data;


		            
				    	if(dados["frente_cor_preco"] == -1){

				    		var elemento = document.getElementById("cores");
				    		elemento.style.display = "none";
				    	}
				    	else{
				    		document.getElementById("cores").style.display="";
				    	}

				    	if(dados["frente_preto_branco_preco"] == -1){

				    		var elemento = document.getElementById("preto_branco");
				    		elemento.style.display = "none";
				    	}
				    	else{
				    		document.getElementById("preto_branco").style.display="";
				    	}

				    	if(dados["frente_verso_cor_preco"] == -1){

				    		var elemento = document.getElementById("cores");
				    		elemento.style.display = "none";
				    	}
				    	else{
				    		document.getElementById("cores").style.display="";
				    	}

				    	if(dados["frente_verso_preto_branco_preco"] == -1){

				    		var elemento = document.getElementById("preto_branco");
				    		elemento.style.display = "none";
				    	}
				    	else{
				    		document.getElementById("preto_branco").style.display="";
				    	}


				    	if(dados["encadernacao"] == -1){

				    		var elemento = document.getElementById("encadernacao");
				    		elemento.style.display = "none";
				    	}
				    	else{
				    		document.getElementById("encadernacao").style.display="";
				    	}
				    	if(dados["plastificacao"] == -1){

				    		var elemento = document.getElementById("plastificacao");
				    		elemento.style.display = "none";
				    	}
				    	else{
				    		document.getElementById("plastificacao").style.display="";
				    	}
				    

		        },
		        failure:(response_data)=>{
		            console.log("FAILURE===", response_data);
		        }

		    });


		});








    </script>
{% endblock %}
